<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: headFragment}"> </head>

<body>
<header th:replace="~{fragments/header :: headerFragment}"></header>

<div class="container mt-5">
    <h1 class="mb-4 text-center">Dorm Manager ğŸ </h1>

    <div class="row g-4">
        <!-- ì¢Œì¸¡ ìƒë‹¨: ìƒí™œê´€ ì¶”ê°€ -->
        <div class="col-md-6">
            <div class="card p-4 h-100">
                <h4 class="mb-3">ìƒí™œê´€ ì¶”ê°€</h4>
                <form id="createDormForm">
                    <div class="mb-3">
                        <label for="dormCode" class="form-label">ìƒí™œê´€ ì½”ë“œ</label>
                        <input type="text" class="form-control" id="dormCode" required>
                    </div>
                    <div class="mb-3">
                        <label for="dormName" class="form-label">ìƒí™œê´€ ì´ë¦„</label>
                        <input type="text" class="form-control" id="dormName" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ìƒí™œê´€ ì¶”ê°€í•˜ê¸°</button>
                    <p id="dormStatus" class="status-msg text-muted">Enter details to create a dorm.</p>
                </form>
            </div>
        </div>

        <!-- ìš°ì¸¡ ìƒë‹¨: ìƒí™œê´€ ì‚­ì œ -->
        <div class="col-md-6">
            <div class="card p-4 h-100">
                <h4 class="mb-3">ìƒí™œê´€ ì‚­ì œ</h4>
                <form id="deleteDormForm">
                    <div class="mb-3">
                        <label for="deleteDormCode" class="form-label">ì‚­ì œí•  ìƒí™œê´€ ì½”ë“œ</label>
                        <input type="text" class="form-control" id="deleteDormCode" required>
                    </div>
                    <button type="submit" class="btn btn-danger">ìƒí™œê´€ ì‚­ì œ</button>
                    <p id="deleteDormStatus" class="status-msg text-muted">Enter dorm code to delete.</p>
                </form>
            </div>
        </div>

        <!-- ì¢Œì¸¡ í•˜ë‹¨: í˜¸ì‹¤ ì¶”ê°€ -->
        <div class="col-md-6">
            <div class="card p-4 h-100">
                <h4 class="mb-3">í˜¸ì‹¤ ì¶”ê°€</h4>
                <form id="createRoomForm">
                    <div class="mb-3">
                        <label for="roomDormCode" class="form-label">ìƒí™œê´€ ì½”ë“œ</label>
                        <input type="text" class="form-control" id="roomDormCode" required>
                    </div>
                    <div class="mb-3">
                        <label for="floor" class="form-label">ì¸µ</label>
                        <input type="number" class="form-control" id="floor" value="1" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label for="roomNumber" class="form-label">í˜¸ì‹¤ ë²ˆí˜¸</label>
                        <input type="text" class="form-control" id="roomNumber" required>
                    </div>
                    <button type="submit" class="btn btn-primary">í˜¸ì‹¤ ì¶”ê°€í•˜ê¸°</button>
                    <p id="roomStatus" class="status-msg text-muted">Enter details to create a room.</p>
                </form>
            </div>
        </div>

        <!-- ìš°ì¸¡ í•˜ë‹¨: í˜¸ì‹¤ ì‚­ì œ -->
        <div class="col-md-6">
            <div class="card p-4 h-100">
                <h4 class="mb-3">í˜¸ì‹¤ ì‚­ì œ</h4>
                <form id="deleteRoomForm">
                    <div class="mb-3">
                        <label for="deleteRoomId" class="form-label">ì‚­ì œí•  í˜¸ì‹¤ ID</label>
                        <input type="number" class="form-control" id="deleteRoomId" required>
                    </div>
                    <button type="submit" class="btn btn-danger">í˜¸ì‹¤ ì‚­ì œ</button>
                    <p id="deleteRoomStatus" class="status-msg text-muted">Enter room ID to delete.</p>
                </form>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    // ìƒí™œê´€ ì¶”ê°€
    document.getElementById('createDormForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const dormCode = document.getElementById('dormCode').value;
        const dormName = document.getElementById('dormName').value;
        const statusEl = document.getElementById('dormStatus');

        try {
            const res = await axios.post('/api/dorms', { dormCode, dormName });
            statusEl.textContent = `âœ… dorm created! ID: ${res.data}`;
            statusEl.style.color = 'blue';
            e.target.reset();
        } catch (err) {
            statusEl.textContent = 'âš ï¸ Error creating dorm';
            statusEl.style.color = 'red';
        }
    });

    // ìƒí™œê´€ ì‚­ì œ
    document.getElementById('deleteDormForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const dormCode = document.getElementById('deleteDormCode').value;
        const statusEl = document.getElementById('deleteDormStatus');

        try {
            await axios.delete(`/api/dorms/${dormCode}`);
            statusEl.textContent = `âœ… Dorm ${dormCode} deleted`;
            statusEl.style.color = 'blue';
            e.target.reset();
        } catch (err) {
            statusEl.textContent = `âš ï¸ Error deleting dorm ${dormCode}`;
            statusEl.style.color = 'red';
        }
    });

    // í˜¸ì‹¤ ì¶”ê°€
    document.getElementById('createRoomForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const dormCode = document.getElementById('roomDormCode').value;
        const floor = parseInt(document.getElementById('floor').value);
        const roomNumber = document.getElementById('roomNumber').value;
        const statusEl = document.getElementById('roomStatus');

        try {
            const res = await axios.post('/api/rooms', { dormCode, floor, roomNumber });
            statusEl.textContent = `âœ… Room created! ID: ${res.data}`;
            statusEl.style.color = 'blue';
            e.target.reset();
        } catch (err) {
            statusEl.textContent = 'âš ï¸ Error creating room';
            statusEl.style.color = 'red';
        }
    });

    // í˜¸ì‹¤ ì‚­ì œ
    document.getElementById('deleteRoomForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const roomId = document.getElementById('deleteRoomId').value;
        const statusEl = document.getElementById('deleteRoomStatus');

        try {
            await axios.delete(`/api/rooms/${roomId}`);
            statusEl.textContent = `âœ… Room ID ${roomId} deleted`;
            statusEl.style.color = 'blue';
            e.target.reset();
        } catch (err) {
            statusEl.textContent = `âš ï¸ Error deleting room ID ${roomId}`;
            statusEl.style.color = 'red';
        }
    });
</script>

<footer th:replace="~{fragments/footer :: footerFragment}"></footer>
</body>
</html>
